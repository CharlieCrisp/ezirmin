<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="next" href="Ezirmin.Git_Memory_log.html">
<link rel="Up" href="Ezirmin.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Ezirmin" rel="Chapter" href="Ezirmin.html"><link title="Append-only logs" rel="Section" href="#1_Appendonlylogs">
<title>Ezirmin.Git_FS_log</title>
</head>
<body>
<div class="navbar">&nbsp;<a class="up" href="Ezirmin.html" title="Ezirmin">Up</a>
&nbsp;<a class="post" href="Ezirmin.Git_Memory_log.html" title="Ezirmin.Git_Memory_log">Next</a>
</div>
<h1>Functor <a href="type_Ezirmin.Git_FS_log.html">Ezirmin.Git_FS_log</a></h1>

<pre><span class="keyword">module</span> Git_FS_log: <div class="sig_block"><code class="code"><span class="keyword">functor</span> (</code><code class="code"><span class="constructor">V</span></code><code class="code"> : </code><code class="type">Tc.S0</code><code class="code">) <span class="keywordsign">-&gt;</span> </code><code class="type"><a href="Ezirmin.Log.html">Log</a></code><code class="type">  with type elt = V.t</code></div></pre><div class="info module top">
A log abstraction that uses the git filesystem backend.<br>
</div>
<table border="0" cellpadding="3" width="100%">
<tr>
<td align="left" valign="top" width="1%%"><b>Parameters: </b></td>
<td>
<table class="paramstable">
<tr>
<td align="center" valign="top" width="15%">
<code>V</code></td>
<td align="center" valign="top">:</td>
<td><code class="type">Tc.S0</code>
</table>
</td>
</tr>
</table>
<hr width="100%">
<br>
<h1 id="1_Appendonlylogs">Append-only logs</h1><br>
<br>
<code class="code"><span class="constructor">Log</span></code> provides mergeable append-only logs with support for paginated
      reads. Appending messages to logs and merging two logs are constant time
      operations. Logs can be read in reverse chronological order. Logs also
      provide support for paginated reads.<br>

<pre><span id="TYPErepo"><span class="keyword">type</span> <code class="type"></code>repo</span> </pre>
<div class="info ">
The type of repository handles. A repository contains a set of branches.<br>
</div>


<pre><span id="TYPEbranch"><span class="keyword">type</span> <code class="type"></code>branch</span> </pre>
<div class="info ">
The type of persistent branches.<br>
</div>


<pre><span id="VALinit"><span class="keyword">val</span> init</span> : <code class="type">?root:string -> ?bare:bool -> unit -> <a href="Ezirmin.Log.html#TYPErepo">repo</a> Lwt.t</code></pre><div class="info ">
Initialize and connect to the repository in a backend specific manner.
<p>

      <ul>
<li><code class="code">root</code> is the local git repository's root directory. If unset, the
      current working directory is chosen to be the root.</li>
<li>If <code class="code">bare</code> is set (unset by default), the git repository is made to be
      bare. Otherwise, the contents are expanded into the local filesystem on
      each update. This can cause performance issues on write heavy workloads.</li>
</ul>
<br>
</div>

<pre><span id="VALmaster"><span class="keyword">val</span> master</span> : <code class="type"><a href="Ezirmin.Log.html#TYPErepo">repo</a> -> <a href="Ezirmin.Log.html#TYPEbranch">branch</a> Lwt.t</code></pre><div class="info ">
<code class="code">master repo</code> fetches the master branch of the repository.<br>
</div>

<pre><span id="VALget_branch"><span class="keyword">val</span> get_branch</span> : <code class="type"><a href="Ezirmin.Log.html#TYPErepo">repo</a> -> branch_name:string -> <a href="Ezirmin.Log.html#TYPEbranch">branch</a> Lwt.t</code></pre><div class="info ">
<code class="code">get_branch repo b</code> fetches the branch <code class="code">b</code> by name. If branch <code class="code">b</code> does not
      already exist, then the branch will be created and a handle to it
      returned.<br>
</div>

<pre><span id="VALclone_force"><span class="keyword">val</span> clone_force</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEbranch">branch</a> -> string -> <a href="Ezirmin.Log.html#TYPEbranch">branch</a> Lwt.t</code></pre><div class="info ">
<code class="code">clone_force b n</code> clones the branch <code class="code">b</code> naming the new branch <code class="code">n</code>. If a
      branch named <code class="code">n</code> exists, then that branch will be overwritten.<br>
</div>

<pre><span id="VALmerge"><span class="keyword">val</span> merge</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEbranch">branch</a> -> into:<a href="Ezirmin.Log.html#TYPEbranch">branch</a> -> unit Lwt.t</code></pre><div class="info ">
<code class="code">merge w m</code> merges branch <code class="code">w</code> into <code class="code">m</code>. Merge will always succeed. After
      the merge the branch <code class="code">w</code> continues to exist.<br>
</div>

<pre><span id="TYPEelt"><span class="keyword">type</span> <code class="type"></code>elt</span> </pre>
<div class="info ">
The type of value stored in the log.<br>
</div>


<pre><span id="TYPEcursor"><span class="keyword">type</span> <code class="type"></code>cursor</span> </pre>
<div class="info ">
The type of cursor. The cursor is an abstraction that represents a specifc
      position in the log.<br>
</div>


<pre><span id="VALappend"><span class="keyword">val</span> append</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEbranch">branch</a> -> path:string list -> <a href="Ezirmin.Log.html#TYPEelt">elt</a> -> unit Lwt.t</code></pre><div class="info ">
<code class="code">append b p m</code> appends the message <code class="code">m</code> to the log at path <code class="code">b</code> in the
      branch <code class="code">b</code>. Append is an O(1) operation.<br>
</div>

<pre><span id="VALget_cursor"><span class="keyword">val</span> get_cursor</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEbranch">branch</a> -> path:string list -> <a href="Ezirmin.Log.html#TYPEcursor">cursor</a> option Lwt.t</code></pre><div class="info ">
<code class="code">get_cursor b p</code> fetches the cursor that points to the latest message in
      in the log at path <code class="code">p</code> in the branch <code class="code">b</code>. If the log at path <code class="code">p</code> is empty,
      then the operation returns <code class="code"><span class="constructor">None</span></code>.<br>
</div>

<pre><span id="VALread"><span class="keyword">val</span> read</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEcursor">cursor</a> -><br>       num_items:int -> (<a href="Ezirmin.Log.html#TYPEelt">elt</a> list * <a href="Ezirmin.Log.html#TYPEcursor">cursor</a> option) Lwt.t</code></pre><div class="info ">
<code class="code">read c n</code> reads the next <code class="code">n</code> messages in reverse chronological order at
      the cursor. The operation returns the list of messages read and an
      optional cursor value that represents the tail of the last message read.
      The cursor can then be used to read subsequent messages.
<p>

      If the number of requested message is greater than the number of available
      messages in the log, then the operation returns the available messages and
      <code class="code"><span class="constructor">None</span></code> for the cursor.<br>
</div>

<pre><span id="VALread_all"><span class="keyword">val</span> read_all</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEbranch">branch</a> -> path:string list -> <a href="Ezirmin.Log.html#TYPEelt">elt</a> list Lwt.t</code></pre><div class="info ">
<code class="code">read_all b p</code> reads all the messages in the log at path <code class="code">p</code> in the branch
      <code class="code">b</code> in reverse chronological order.<br>
</div>

<pre><span id="VALinstall_listener"><span class="keyword">val</span> install_listener</span> : <code class="type">float -> unit</code></pre><div class="info ">
Create a thread that actively polls for change. The parameter is the thread sleep
      time. Prefer <a href="https://opam.ocaml.org/packages/inotify/inotify.2.0/">inotify</a>
      if it works on your system.<br>
</div>

<pre><span id="VALwatch"><span class="keyword">val</span> watch</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEbranch">branch</a> -><br>       path:string list -><br>       (<a href="Ezirmin.Log.html#TYPEelt">elt</a> -> unit Lwt.t) -> (unit -> unit Lwt.t) Lwt.t</code></pre><div class="info ">
<code class="code">watch b p cb</code> watches the log at the path <code class="code">b</code> in the branch <code class="code">b</code>. On each
      append of a message <code class="code">m</code> to the log, the callback function <code class="code">cb m</code> is
      invoked. Before installing watches, a listener thread must be started with
      <a href="Ezirmin.Log.html#VALinstall_listener"><code class="code"><span class="constructor">Ezirmin</span>.<span class="constructor">Log</span>.install_listener</code></a> that watches the stores for changes.<br>
<b>Returns</b> a function to disable the watch.<br>
</div>

<pre><span id="VALuninstall_listener"><span class="keyword">val</span> uninstall_listener</span> : <code class="type">unit -> unit</code></pre><div class="info ">
Stop the thread started by <a href="Ezirmin.Log.html#VALinstall_listener"><code class="code"><span class="constructor">Ezirmin</span>.<span class="constructor">Log</span>.install_listener</code></a>.<br>
</div>
</body></html>