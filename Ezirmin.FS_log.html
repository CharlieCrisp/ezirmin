<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Ezirmin.FS_blob_log.html">
<link rel="next" href="Ezirmin.FS_lww_register.html">
<link rel="Up" href="Ezirmin.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Ezirmin" rel="Chapter" href="Ezirmin.html"><link title="An efficient write-optimized append-only logs" rel="Section" href="#1_Anefficientwriteoptimizedappendonlylogs">
<link title="Watch" rel="Subsection" href="#2_Watch">
<title>Ezirmin.FS_log</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Ezirmin.FS_blob_log.html" title="Ezirmin.FS_blob_log">Previous</a>
&nbsp;<a class="up" href="Ezirmin.html" title="Ezirmin">Up</a>
&nbsp;<a class="post" href="Ezirmin.FS_lww_register.html" title="Ezirmin.FS_lww_register">Next</a>
</div>
<h1>Functor <a href="type_Ezirmin.FS_log.html">Ezirmin.FS_log</a></h1>

<pre><span class="keyword">module</span> FS_log: <div class="sig_block"><code class="code"><span class="keyword">functor</span> (</code><code class="code"><span class="constructor">V</span></code><code class="code"> : </code><code class="type">Tc.S0</code><code class="code">) <span class="keywordsign">-&gt;</span> </code><code class="type"><a href="Ezirmin.Log.html">Log</a></code><code class="type">  with type elt = V.t</code></div></pre><div class="info module top">
An efficient write-optimized log abstraction that uses the git filesystem
    backend.<br>
</div>
<table border="0" cellpadding="3" width="100%">
<tr>
<td align="left" valign="top" width="1%%"><b>Parameters: </b></td>
<td>
<table class="paramstable">
<tr>
<td align="center" valign="top" width="15%">
<code>V</code></td>
<td align="center" valign="top">:</td>
<td><code class="type">Tc.S0</code>
</table>
</td>
</tr>
</table>
<hr width="100%">
<br>
<h1 id="1_Anefficientwriteoptimizedappendonlylogs">An efficient write-optimized append-only logs</h1><br>
<br>
<code class="code"><span class="constructor">Log</span></code> provides mergeable append-only logs with support for paginated
      reads. Appending messages to logs and merging two logs are constant time
      operations. Logs can be read in reverse chronological order. Logs also
      provide support for paginated reads.<br>

<pre><span class="keyword">include</span> <a href="Ezirmin.Repo.html">Ezirmin.Repo</a></pre>

<pre><span id="TYPEelt"><span class="keyword">type</span> <code class="type"></code>elt</span> </pre>
<div class="info ">
The type of value stored in the log.<br>
</div>


<pre><span id="TYPEcursor"><span class="keyword">type</span> <code class="type"></code>cursor</span> </pre>
<div class="info ">
The type of cursor. The cursor is an abstraction that represents a specifc
      position in the log.<br>
</div>


<pre><span id="VALappend"><span class="keyword">val</span> append</span> : <code class="type">branch -> path:string list -> <a href="Ezirmin.Log.html#TYPEelt">elt</a> -> unit Lwt.t</code></pre><div class="info ">
<code class="code">append b p m</code> appends the message <code class="code">m</code> to the log at path <code class="code">b</code> in the
      branch <code class="code">b</code>. Append is an O(1) operation.<br>
</div>

<pre><span id="VALget_cursor"><span class="keyword">val</span> get_cursor</span> : <code class="type">branch -> path:string list -> <a href="Ezirmin.Log.html#TYPEcursor">cursor</a> option Lwt.t</code></pre><div class="info ">
<code class="code">get_cursor b p</code> fetches the cursor that points to the latest message in
      in the log at path <code class="code">p</code> in the branch <code class="code">b</code>. If the log at path <code class="code">p</code> is empty,
      then the operation returns <code class="code"><span class="constructor">None</span></code>.<br>
</div>

<pre><span id="VALread"><span class="keyword">val</span> read</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEcursor">cursor</a> -><br>       num_items:int -> (<a href="Ezirmin.Log.html#TYPEelt">elt</a> list * <a href="Ezirmin.Log.html#TYPEcursor">cursor</a> option) Lwt.t</code></pre><div class="info ">
<code class="code">read c n</code> reads the next <code class="code">n</code> messages in reverse chronological order at
      the cursor. The operation returns the list of messages read and an
      optional cursor value that represents the tail of the last message read.
      The cursor can then be used to read subsequent messages.
<p>

      If the number of requested message is greater than the number of available
      messages in the log, then the operation returns the available messages and
      <code class="code"><span class="constructor">None</span></code> for the cursor.<br>
</div>

<pre><span id="VALread_all"><span class="keyword">val</span> read_all</span> : <code class="type">branch -> path:string list -> <a href="Ezirmin.Log.html#TYPEelt">elt</a> list Lwt.t</code></pre><div class="info ">
<code class="code">read_all b p</code> reads all the messages in the log at path <code class="code">p</code> in the branch
      <code class="code">b</code> in reverse chronological order.<br>
</div>

<pre><span id="VALat_time"><span class="keyword">val</span> at_time</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEcursor">cursor</a> -> Ptime.t option</code></pre><div class="info ">
<code class="code">at_time c</code> returns the timestamp of the latest message in the cursor <code class="code">c</code>.<br>
</div>

<pre><span id="VALis_earlier"><span class="keyword">val</span> is_earlier</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEcursor">cursor</a> -> than:<a href="Ezirmin.Log.html#TYPEcursor">cursor</a> -> bool option</code></pre><div class="info ">
<code class="code">is_earlier x y</code> returns <code class="code"><span class="keyword">true</span></code> if the latest message in <code class="code">x</code> is older
      than the latest message in <code class="code">y</code>.<br>
</div>

<pre><span id="VALis_later"><span class="keyword">val</span> is_later</span> : <code class="type"><a href="Ezirmin.Log.html#TYPEcursor">cursor</a> -> than:<a href="Ezirmin.Log.html#TYPEcursor">cursor</a> -> bool option</code></pre><div class="info ">
<code class="code">is_later x y</code> returns <code class="code"><span class="keyword">true</span></code> if the latest message in <code class="code">x</code> is newer
      than the latest message in <code class="code">y</code>.<br>
</div>
<br>
<h2 id="2_Watch">Watch</h2><br>

<pre><span id="VALwatch"><span class="keyword">val</span> watch</span> : <code class="type">branch -><br>       path:string list -><br>       (<a href="Ezirmin.Log.html#TYPEelt">elt</a> -> unit Lwt.t) -> (unit -> unit Lwt.t) Lwt.t</code></pre><div class="info ">
<code class="code">watch b p cb</code> watches the log at the path <code class="code">p</code> in the branch <code class="code">b</code>. On each
      append of a message <code class="code">m</code> to the log, the callback function <code class="code">cb m</code> is
      invoked. Before installing watches, a listener thread must be started
      with <a href="Ezirmin.Repo.html#VALinstall_listener"><code class="code"><span class="constructor">Ezirmin</span>.<span class="constructor">Repo</span>.install_listener</code></a> that watches the store for changes.<br>
<b>Returns</b> a function to disable the watch.<br>
</div>
</body></html>